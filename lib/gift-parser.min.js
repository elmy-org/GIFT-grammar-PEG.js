"use strict";const{isArray:a}=Array;function b(A,_){function B(){this.constructor=A}B.prototype=_.prototype;A.prototype=new B()}function c(C,_b,_c,D){this.message=C;this.expected=_b;this.found=_c;this.location=D;this.name='SyntaxError';Error.captureStackTrace?.(this,c)}b(c,Error);c.buildMessage=(_a,_B)=>{var _C={literal:function(_A){return`"${e(_A.text)}"`},'class':function(E){var aA='',i;for(i=0;i<E.parts.length;i++)aA+=a(E.parts[i])?f(E.parts[i][0])+'-'+f(E.parts[i][1]):f(E.parts[i]);return '['+(E.inverted?'^':'')+aA+']'},any:function(aB){return'any character'},end:function(aC){return'end of input'},other:function(aD){return aD.description}};function _d(ch){return ch.charCodeAt(0).toString(16).toUpperCase()}function e(s){return s.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\0/g,'\\0').replace(/\t/g,'\\t').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/[\x00-\x0F]/g,function(ch){return '\\x0'+_d(ch)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(ch){return '\\x'+_d(ch)})}function f(s){return s.replace(/\\/g,'\\\\').replace(/\]/g,'\\]').replace(/\^/g,'\\^').replace(/-/g,'\\-').replace(/\0/g,'\\0').replace(/\t/g,'\\t').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/[\x00-\x0F]/g,function(ch){return '\\x0'+_d(ch)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(ch){return '\\x'+_d(ch)})}function g(aE){return _C[aE.type](aE)}function h(aF){var aG=Array(aF.length),i,j;for(i=0;i<aF.length;i++)aG[i]=g(aF[i]);aG.sort();if(aG.length>0){for(i=1,j=1;i<aG.length;i++)aG[i-1]!==aG[i]&&(aG[j]=aG[i],j++);aG.length=j}switch(aG.length) {case 1:return aG[0];case 2:return aG[0]+' or '+aG[1];default:return aG.slice(0,-1).join(', ')+', or '+aG[aG.length-1]}}function I(aH){return aH?`"${e(aH)}"`:'end of input'}return 'Expected '+h(_a)+' but '+I(_B)+' found.'};function d(aI,aJ){aJ===void 0&&(aJ={});var aK={},_D={GIFTQuestions:gS},_e=gS,F=function(jL){return jL},G=gM('Category'),H='$',_i=gI('$',!1),J='CATEGORY:',k=gI('CATEGORY:',!1),l=function(jM){return{type:'Category',title:jM}},M=gM('Description'),n=function(jN,jO){var jP={id:iY,tags:iZ,type:'Description',title:jN,stem:jO,hasEmbeddedAnswers:!1};jJ();iY=iZ=null;return jP},o='{',P=gI('{',!1),q='}',r=gI('}',!1),S=function(jQ,jR,jS,jT){var _E=(jT!==null),_f=jR?(jR.text+(_E?' ':'')):'',_g=jR?.format||jT?.format||'moodle',_h=_f+(_E?'_____ '+jT.text:''),_I={type:jS.type,title:jQ,stem:{format:_g,text:_h},hasEmbeddedAnswers:_E};_I=jE(_I,jS);jJ();return _I},T=gM('{= match1 -> Match1\n...}'),u=function(jU,jV){return{type:'Matching',matchPairs:jU,globalFeedback:jV}},v=gM('matches'),w=function(jW){return jW},x=gM('match'),y='=',z=gI('=',!1),aL='->',aM=gI('->',!1),aN=function(jX,jY){var jZ={subquestion:{format:(jX!==null?jX.format:jI()),text:(jX!==null?jX.text:'')},subanswer:jY};return jZ},aO=gM('{T} or {F} or {TRUE} or {FALSE}'),aP=function(kA,kB,kC){return{type:'TF',isTrue:kA,feedback:kB,globalFeedback:kC}},aQ=function(kD){return kD},aR='TRUE',aS=gI('TRUE',!1),aT='T',aU=gI('T',!1),aV=function(){return!0},aW='FALSE',aX=gI('FALSE',!1),aY='F',aZ=gI('F',!1),bA=function(){return!1},bB=gM('{=correct choice ~incorrect choice ... }'),bC=function(kE,kF){return{type:'MC',choices:kE,globalFeedback:kF}},bD=gM('Choices'),bE=function(kG){return kG},bF=gM('Choice'),bG=/^[=~]/,bH=gJ(['=','~'],!1,!1),bI=function(kH,kI){var kJ=kH[2],kK=kH[4],kH={isCorrect:(kH[0]=='='),weight:kJ,text:kK,feedback:kI};return kH},bJ=gM('(weight)'),bK='%',bL=gI('%',!1),bM=/^\-/,bN=gJ(['-'],!1,!1),bO=function(kL){return parseFloat(kL.join(''))},bP=gM('(percent)'),bQ='100',bR=gI('100',!1),bS=/^\d/,bT=gJ([['0','9']],!1,!1),bU=/^\./,bV=gJ(['.'],!1,!1),bW=function(){return gE()},bX=gM('(feedback)'),bY='#',bZ=gI('#',!1),cA='###',cB=gI('###',!1),cC=function(kM){return kM},cD=gM('Essay question { ... }'),cE='',cF=function(kN){return{type:'Essay',globalFeedback:kN}},cG=gM('Single short answer { ... }'),cH=function(kO,kP,kQ){var kR=[];kR.push({isCorrect:!0,text:kO,feedback:kP,weight:null});return{type:'Short',choices:kR,globalFeedback:kQ}},cI=gM('{#... }'),cJ=function(kS,kT){return{type:'Numerical',choices:kS,globalFeedback:kT}},cK=gM('Numerical Answers'),cL=gM('Multiple Numerical Choices'),cM=gM('Numerical Choice'),cN=function(kU,kV){var kW=kU[0],kX=kU[1],kY=kU[2],kU={isCorrect:(kW=='='),weight:kX,text:(kY!==null?kY:{format:jI(),text:'*'}),feedback:kV};return kU},cO=gM('Single numeric answer'),cP=gM('(number with range)'),cQ=':',cR=gI(':',!1),cS=function(kZ,lA){return{type:'range',number:kZ,range:lA}},cT=gM('(number with high-low)'),cU='..',cV=gI('..',!1),cW=function(lB,lC){return{type:'high-low',numberHigh:lC,numberLow:lB}},cX=gM('(number answer)'),cY=function(lD){return{type:'simple',number:lD}},cZ=gM(':: Title ::'),dA='::',dB=gI('::',!1),dC=function(lE){return jD(lE.join(''))},dD=gM('Question stem'),dE=function(lF){jH(lF.format);return lF},dF=gM('(blank lines separator)'),dG=gM('(blank lines)'),dH=gM('blank line'),dI=gM('(Title text)'),dJ=function(t){return t},dK=gM('(text character)'),dL=gM('format'),dM='[',dN=gI('[',!1),dO='html',dP=gI('html',!1),dQ='markdown',dR=gI('markdown',!1),dS='plain',dT=gI('plain',!1),dU='moodle',dV=gI('moodle',!1),dW=']',dX=gI(']',!1),dY=function(lG){return lG},dZ=gM('(escape character)'),eA='\\',eB=gI('\\',!1),eC=gM('escape sequence'),eD='~',eE=gI('~',!1),eF='n',eG=gI('n',!1),eH=function(lH){return jC[`\${lH}`]},eI=gM(''),eJ=gK(),eK=function(){return gE()},eL=gM('(formatted text excluding \'->\')'),eM=function(lI,lJ){return jK(lI,lJ)},eN=gM('(formatted text)'),eO=gM('(unformatted text)'),eP=function(lK){return jG(lK.join('').trim())},eQ=gM('(category text)'),eR=function(lL){return lL.flat().join('')},eS=function(){return parseFloat(gE())},eT='.',eU=gI('.',!1),eV=/^[+\-]/,eW=gJ(['+','-'],!1,!1),eX='####',eY=gI('####',!1),eZ=function(rt){return rt},fA=gM('(single line whitespace)'),fB=gM('(multiple line whitespace)'),fC=' ',fD=gI(' ',!1),fE=function(){iY=iZ=null},fF=gM('(comment)'),fG='//',fH=gI('//',!1),fI=/^[^\n\r]/,fJ=gJ(['\n','\r'],!0,!1),fK=function(p){return null},fL=function(p){var lM=p.join(''),lN=lM.match(/\[id:([^\x00-\x1F\x7F]+?)]/);lN&&(iY=lN[1].trim().replace('\\]',']'));var lO=lM.matchAll(/\[tag:([^\x00-\x1F\x7F]+?)]/g);Array.from(lM.matchAll(/\[tag:([^\x00-\x1F\x7F]+?)]/g),function(m){return m[1]}).forEach(lP=>{!iZ&&(iZ=[]);iZ.push(lP)});return null},fM=gM('(space)'),fN='\t',fO=gI('\t',!1),fP=gM('(end of line)'),fQ='\r\n',fR=gI('\r\n',!1),fS='\n',fT=gI('\n',!1),fU='\r',fV=gI('\r',!1),fW=function(){return'EOF'},fX=0,fY=0,fZ=[{line:1,column:1}],gA=0,gB=[],gC=0,gD;if('startRule' in aJ){if(!(aJ.startRule in _D))throw Error('Can't start parsing from rule \"'+aJ.startRule+'\".');_e=_D[aJ.startRule]}function gE(){return aI.substring(fY,fX)}function gF(){return gO(fY,fX)}function gG(lQ,lR){lR===void 0&&(lR=gO(fY,fX));throw gR([gM(lQ)],aI.substring(fY,fX),lR)}function gH(lS,lT){lT===void 0&&(lT=gO(fY,fX));throw gQ(lS,lT)}function gI(lU,lV){return{type:'literal',text:lU,ignoreCase:lV}}function gJ(lW,lX,lY){return{type:'class',parts:lW,inverted:lX,ignoreCase:lY}}function gK(){return{type:'any'}}function gL(){return{type:'end'}}function gM(lZ){return{type:'other',description:lZ}}function gN(mA){var mB=fZ[mA],p;if(mB)return mB;p=mA-1;while (!fZ[p])p--;mB=fZ[p];mB={line:mB.line,column:mB.column};while (p<mA) {aI.charCodeAt(p)===10?(mB.line++,mB.column=1):(mB.column++);p++}fZ[mA]=mB;return mB}function gO(mC,mD){var mE=gN(mC),mF=gN(mD);return{start:{offset:mC,line:mE.line,column:mE.column},end:{offset:mD,line:mF.line,column:mF.column}}}function gP(mG){if(fX<gA)return;fX>gA&&(gA=fX,gB=[]);gB.push(mG)}function gQ(mH,mI){return new c(mH, null, null, mI)}function gR(mJ,mK,mL){return new c(c.buildMessage(mJ,mK), mJ, mK, mL)}function gS(){var mM,mN,mO,mP;mM=fX;mN=[];mO=gT();if(mO===aK){mO=gU();mO===aK&&(mO=gV())}if(mO!==aK)while (mO!==aK) {mN.push(mO);mO=gT();if(mO===aK){mO=gU();mO===aK&&(mO=gV())}}else mN=aK;if(mN!==aK){mO=iQ();if(mO!==aK){mP=iR();mP!==aK?(fY=mM,mN=F(mN),mM=mN):(fX=mM,mM=aK)}else{fX=mM;mM=aK}}else{fX=mM;mM=aK}return mM}function gT(){var mQ,mR,mS,mT,mU,_F,_G,_H;gC++;mQ=fX;mR=iS();if(mR!==aK){mS=iR();if(mS!==aK){if(aI.charCodeAt(fX)===36){mT=H;fX++}else{mT=aK;gC===0&&gP(_i)}if(mT!==aK){if(aI.substr(fX,9)===J){mU=J;fX+=9}else{mU=aK;gC===0&&gP(k)}if(mU!==aK){_F=iQ();if(_F!==aK){_G=iK();if(_G!==aK){_H=hV();_H!==aK?(fY=mQ,mR=l(_G),mQ=mR):(fX=mQ,mQ=aK)}else{fX=mQ;mQ=aK}}else{fX=mQ;mQ=aK}}else{fX=mQ;mQ=aK}}else{fX=mQ;mQ=aK}}else{fX=mQ;mQ=aK}}else{fX=mQ;mQ=aK}gC--;if(mQ===aK){mR=aK;gC===0&&gP(G)}return mQ}function gU(){var mV,mW,mX,mY,mZ,nA,nB,nC;gC++;mV=fX;mW=iS();if(mW!==aK){mX=iR();if(mX!==aK){mY=[];mZ=iU();while (mZ!==aK) {mY.push(mZ);mZ=iU()}if(mY!==aK){mZ=hT();mZ===aK&&(mZ=null);if(mZ!==aK){nA=iQ();if(nA!==aK){nB=hU();if(nB!==aK){nC=hV();nC!==aK?(fY=mV,mW=n(mZ,nB),mV=mW):(fX=mV,mV=aK)}else{fX=mV;mV=aK}}else{fX=mV;mV=aK}}else{fX=mV;mV=aK}}else{fX=mV;mV=aK}}else{fX=mV;mV=aK}}else{fX=mV;mV=aK}gC--;if(mV===aK){mW=aK;gC===0&&gP(M)}return mV}function gV(){var nD,nE,nF,nG,nH,nI,nJ,nK,nL,_j,K,L,_m,N,O,_p;nD=fX;nE=iS();if(nE!==aK){nF=iR();if(nF!==aK){nG=[];nH=iU();while (nH!==aK) {nG.push(nH);nH=iU()}if(nG!==aK){nH=hT();nH===aK&&(nH=null);if(nH!==aK){nI=iQ();if(nI!==aK){nJ=hU();nJ===aK&&(nJ=null);if(nJ!==aK){nK=iQ();if(nK!==aK){if(aI.charCodeAt(fX)===123){nL=o;fX++}else{nL=aK;gC===0&&gP(P)}if(nL!==aK){_j=iQ();if(_j!==aK){K=gW();if(K===aK){K=gZ();if(K===aK){K=hD();if(K===aK){K=hL();if(K===aK){K=hK();K===aK&&(K=hJ())}}}}if(K!==aK){L=iQ();if(L!==aK){if(aI.charCodeAt(fX)===125){_m=q;fX++}else{_m=aK;gC===0&&gP(r)}if(_m!==aK){N=iQ();if(N!==aK){O=iT();O===aK&&(O=hU());O===aK&&(O=null);if(O!==aK){_p=hV();_p!==aK?(fY=nD,nE=S(nH,nJ,K,O),nD=nE):(fX=nD,nD=aK)}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}}else{fX=nD;nD=aK}return nD}function gW(){var nM,nN,nO,nP,nQ;gC++;nM=fX;nN=gX();if(nN!==aK){nO=iQ();if(nO!==aK){nP=iP();nP===aK&&(nP=null);if(nP!==aK){nQ=iQ();nQ!==aK?(fY=nM,nN=u(nN,nP),nM=nN):(fX=nM,nM=aK)}else{fX=nM;nM=aK}}else{fX=nM;nM=aK}}else{fX=nM;nM=aK}gC--;if(nM===aK){nN=aK;gC===0&&gP(T)}return nM}function gX(){var nR,nS,nT;gC++;nR=fX;nS=[];nT=gY();if(nT!==aK)while (nT!==aK) {nS.push(nT);nT=gY()}else nS=aK;nS!==aK&&(fY=nR,nS=w(nS));nR=nS;gC--;if(nR===aK){nS=aK;gC===0&&gP(v)}return nR}function gY(){var nU,nV,nW,nX,nY,nZ,oA,oB,oC,_J;gC++;nU=fX;nV=iQ();if(nV!==aK){if(aI.charCodeAt(fX)===61){nW=y;fX++}else{nW=aK;gC===0&&gP(z)}if(nW!==aK){nX=iQ();if(nX!==aK){nY=iH();nY===aK&&(nY=null);if(nY!==aK){nZ=iQ();if(nZ!==aK){if(aI.substr(fX,2)===aL){oA=aL;fX+=2}else{oA=aK;gC===0&&gP(aM)}if(oA!==aK){oB=iQ();if(oB!==aK){oC=iJ();if(oC!==aK){_J=iQ();_J!==aK?(fY=nU,nV=aN(nY,oC),nU=nV):(fX=nU,nU=aK)}else{fX=nU;nU=aK}}else{fX=nU;nU=aK}}else{fX=nU;nU=aK}}else{fX=nU;nU=aK}}else{fX=nU;nU=aK}}else{fX=nU;nU=aK}}else{fX=nU;nU=aK}}else{fX=nU;nU=aK}gC--;if(nU===aK){nV=aK;gC===0&&gP(x)}return nU}function gZ(){var oD,oE,oF,oG,oH,oI;gC++;oD=fX;oE=hA();if(oE!==aK){oF=iQ();if(oF!==aK){oG=fX;oH=hI();oH===aK&&(oH=null);if(oH!==aK){oI=hI();oI===aK&&(oI=null);oI!==aK?(oH=[oH,oI],oG=oH):(fX=oG,oG=aK)}else{fX=oG;oG=aK}if(oG!==aK){oH=iQ();if(oH!==aK){oI=iP();oI===aK&&(oI=null);oI!==aK?(fY=oD,oE=aP(oE,oG,oI),oD=oE):(fX=oD,oD=aK)}else{fX=oD;oD=aK}}else{fX=oD;oD=aK}}else{fX=oD;oD=aK}}else{fX=oD;oD=aK}gC--;if(oD===aK){oE=aK;gC===0&&gP(aO)}return oD}function hA(){var oJ,oK;oJ=fX;oK=hB();oK===aK&&(oK=hC());oK!==aK&&(fY=oJ,oK=aQ(oK));oJ=oK;return oJ}function hB(){var oL,oM;oL=fX;if(aI.substr(fX,4)===aR){oM=aR;fX+=4}else{oM=aK;gC===0&&gP(aS)}if(oM===aK)if(aI.charCodeAt(fX)===84){oM=aT;fX++}else{oM=aK;gC===0&&gP(aU)}oM!==aK&&(fY=oL,oM=aV());oL=oM;return oL}function hC(){var oN,oO;oN=fX;if(aI.substr(fX,5)===aW){oO=aW;fX+=5}else{oO=aK;gC===0&&gP(aX)}if(oO===aK)if(aI.charCodeAt(fX)===70){oO=aY;fX++}else{oO=aK;gC===0&&gP(aZ)}oO!==aK&&(fY=oN,oO=bA());oN=oO;return oN}function hD(){var oP,oQ,oR,oS,oT;gC++;oP=fX;oQ=hE();if(oQ!==aK){oR=iQ();if(oR!==aK){oS=iP();oS===aK&&(oS=null);if(oS!==aK){oT=iQ();oT!==aK?(fY=oP,oQ=bC(oQ,oS),oP=oQ):(fX=oP,oP=aK)}else{fX=oP;oP=aK}}else{fX=oP;oP=aK}}else{fX=oP;oP=aK}gC--;if(oP===aK){oQ=aK;gC===0&&gP(bB)}return oP}function hE(){var oU,oV,oW;gC++;oU=fX;oV=[];oW=hF();if(oW!==aK)while (oW!==aK) {oV.push(oW);oW=hF()}else oV=aK;oV!==aK&&(fY=oU,oV=bE(oV));oU=oV;gC--;if(oU===aK){oV=aK;gC===0&&gP(bD)}return oU}function hF(){var oX,oY,oZ,pA,pB,pC,pD,pE;gC++;oX=fX;oY=iQ();if(oY!==aK){oZ=fX;if(bG.test(aI.charAt(fX))){pA=aI.charAt(fX);fX++}else{pA=aK;gC===0&&gP(bH)}if(pA!==aK){pB=iQ();if(pB!==aK){pC=hG();pC===aK&&(pC=null);if(pC!==aK){pD=iQ();if(pD!==aK){pE=iI();pE!==aK?(pA=[pA,pB,pC,pD,pE],oZ=pA):(fX=oZ,oZ=aK)}else{fX=oZ;oZ=aK}}else{fX=oZ;oZ=aK}}else{fX=oZ;oZ=aK}}else{fX=oZ;oZ=aK}if(oZ!==aK){pA=hI();pA===aK&&(pA=null);if(pA!==aK){pB=iQ();pB!==aK?(fY=oX,oY=bI(oZ,pA),oX=oY):(fX=oX,oX=aK)}else{fX=oX;oX=aK}}else{fX=oX;oX=aK}}else{fX=oX;oX=aK}gC--;if(oX===aK){oY=aK;gC===0&&gP(bF)}return oX}function hG(){var pF,pG,pH,pI,pJ;gC++;pF=fX;if(aI.charCodeAt(fX)===37){pG=bK;fX++}else{pG=aK;gC===0&&gP(bL)}if(pG!==aK){pH=fX;if(bM.test(aI.charAt(fX))){pI=aI.charAt(fX);fX++}else{pI=aK;gC===0&&gP(bN)}pI===aK&&(pI=null);if(pI!==aK){pJ=hH();pJ!==aK?(pI=[pI,pJ],pH=pI):(fX=pH,pH=aK)}else{fX=pH;pH=aK}if(pH!==aK){if(aI.charCodeAt(fX)===37){pI=bK;fX++}else{pI=aK;gC===0&&gP(bL)}pI!==aK?(fY=pF,pG=bO(pH),pF=pG):(fX=pF,pF=aK)}else{fX=pF;pF=aK}}else{fX=pF;pF=aK}gC--;if(pF===aK){pG=aK;gC===0&&gP(bJ)}return pF}function hH(){var pK,pL,pM,pN,pO,pP;gC++;if(aI.substr(fX,3)===bQ){pK=bQ;fX+=3}else{pK=aK;gC===0&&gP(bR)}if(pK===aK){pK=fX;if(bS.test(aI.charAt(fX))){pL=aI.charAt(fX);fX++}else{pL=aK;gC===0&&gP(bT)}if(pL!==aK){if(bS.test(aI.charAt(fX))){pM=aI.charAt(fX);fX++}else{pM=aK;gC===0&&gP(bT)}pM===aK&&(pM=null);if(pM!==aK){if(bU.test(aI.charAt(fX))){pN=aI.charAt(fX);fX++}else{pN=aK;gC===0&&gP(bV)}pN===aK&&(pN=null);if(pN!==aK){pO=[];if(bS.test(aI.charAt(fX))){pP=aI.charAt(fX);fX++}else{pP=aK;gC===0&&gP(bT)}while (pP!==aK) {pO.push(pP);if(bS.test(aI.charAt(fX))){pP=aI.charAt(fX);fX++}else{pP=aK;gC===0&&gP(bT)}}pO!==aK?(fY=pK,pL=bW(),pK=pL):(fX=pK,pK=aK)}else{fX=pK;pK=aK}}else{fX=pK;pK=aK}}else{fX=pK;pK=aK}}gC--;if(pK===aK){pL=aK;gC===0&&gP(bP)}return pK}function hI(){var pQ,pR,pS,pT,pU;gC++;pQ=fX;if(aI.charCodeAt(fX)===35){pR=bY;fX++}else{pR=aK;gC===0&&gP(bZ)}if(pR!==aK){pS=fX;gC++;if(aI.substr(fX,3)===cA){pT=cA;fX+=3}else{pT=aK;gC===0&&gP(cB)}gC--;pT===aK?pS=void 0:fX=pS;if(pS!==aK){pT=iQ();if(pT!==aK){pU=iI();pU===aK&&(pU=null);pU!==aK?(fY=pQ,pR=cC(pU),pQ=pR):(fX=pQ,pQ=aK)}else{fX=pQ;pQ=aK}}else{fX=pQ;pQ=aK}}else{fX=pQ;pQ=aK}gC--;if(pQ===aK){pR=aK;gC===0&&gP(bX)}return pQ}function hJ(){var pV,pW,pX,pY,pZ;gC++;pV=fX;pW=cE;if(pW!==aK){pX=iQ();if(pX!==aK){pY=iP();pY===aK&&(pY=null);if(pY!==aK){pZ=iQ();pZ!==aK?(fY=pV,pW=cF(pY),pV=pW):(fX=pV,pV=aK)}else{fX=pV;pV=aK}}else{fX=pV;pV=aK}}else{fX=pV;pV=aK}gC--;if(pV===aK){pW=aK;gC===0&&gP(cD)}return pV}function hK(){var qA,qB,qC,qD,qE,qF,qG;gC++;qA=fX;qB=iI();if(qB!==aK){qC=iQ();if(qC!==aK){qD=hI();qD===aK&&(qD=null);if(qD!==aK){qE=iQ();if(qE!==aK){qF=iP();qF===aK&&(qF=null);if(qF!==aK){qG=iQ();qG!==aK?(fY=qA,qB=cH(qB,qD,qF),qA=qB):(fX=qA,qA=aK)}else{fX=qA;qA=aK}}else{fX=qA;qA=aK}}else{fX=qA;qA=aK}}else{fX=qA;qA=aK}}else{fX=qA;qA=aK}gC--;if(qA===aK){qB=aK;gC===0&&gP(cG)}return qA}function hL(){var qH,qI,qJ,qK,qL,qM;gC++;qH=fX;if(aI.charCodeAt(fX)===35){qI=bY;fX++}else{qI=aK;gC===0&&gP(bZ)}if(qI!==aK){qJ=iQ();if(qJ!==aK){qK=hM();if(qK!==aK){qL=iQ();if(qL!==aK){qM=iP();qM===aK&&(qM=null);qM!==aK?(fY=qH,qI=cJ(qK,qM),qH=qI):(fX=qH,qH=aK)}else{fX=qH;qH=aK}}else{fX=qH;qH=aK}}else{fX=qH;qH=aK}}else{fX=qH;qH=aK}gC--;if(qH===aK){qI=aK;gC===0&&gP(cI)}return qH}function hM(){var qN;gC++;qN=hN();qN===aK&&(qN=hP());gC--;if(qN===aK){gC===0&&gP(cK)}return qN}function hN(){var qO,qP,qQ;gC++;qO=fX;qP=[];qQ=hO();if(qQ!==aK)while (qQ!==aK) {qP.push(qQ);qQ=hO()}else qP=aK;qP!==aK&&(fY=qO,qP=bE(qP));qO=qP;gC--;if(qO===aK){qP=aK;gC===0&&gP(cL)}return qO}function hO(){var qR,qS,qT,qU,qV,qW;gC++;qR=fX;qS=iQ();if(qS!==aK){qT=fX;if(bG.test(aI.charAt(fX))){qU=aI.charAt(fX);fX++}else{qU=aK;gC===0&&gP(bH)}if(qU!==aK){qV=hG();qV===aK&&(qV=null);if(qV!==aK){qW=hP();qW===aK&&(qW=null);qW!==aK?(qU=[qU,qV,qW],qT=qU):(fX=qT,qT=aK)}else{fX=qT;qT=aK}}else{fX=qT;qT=aK}if(qT!==aK){qU=iQ();if(qU!==aK){qV=hI();qV===aK&&(qV=null);if(qV!==aK){qW=iQ();qW!==aK?(fY=qR,qS=cN(qT,qV),qR=qS):(fX=qR,qR=aK)}else{fX=qR;qR=aK}}else{fX=qR;qR=aK}}else{fX=qR;qR=aK}}else{fX=qR;qR=aK}gC--;if(qR===aK){qS=aK;gC===0&&gP(cM)}return qR}function hP(){var qX;gC++;qX=hQ();if(qX===aK){qX=hR();qX===aK&&(qX=hS())}gC--;if(qX===aK){gC===0&&gP(cO)}return qX}function hQ(){var qY,qZ,rA,rB;gC++;qY=fX;qZ=iL();if(qZ!==aK){if(aI.charCodeAt(fX)===58){rA=cQ;fX++}else{rA=aK;gC===0&&gP(cR)}if(rA!==aK){rB=iL();rB!==aK?(fY=qY,qZ=cS(qZ,rB),qY=qZ):(fX=qY,qY=aK)}else{fX=qY;qY=aK}}else{fX=qY;qY=aK}gC--;if(qY===aK){qZ=aK;gC===0&&gP(cP)}return qY}function hR(){var rC,rD,rE,rF;gC++;rC=fX;rD=iL();if(rD!==aK){if(aI.substr(fX,2)===cU){rE=cU;fX+=2}else{rE=aK;gC===0&&gP(cV)}if(rE!==aK){rF=iL();rF!==aK?(fY=rC,rD=cW(rD,rF),rC=rD):(fX=rC,rC=aK)}else{fX=rC;rC=aK}}else{fX=rC;rC=aK}gC--;if(rC===aK){rD=aK;gC===0&&gP(cT)}return rC}function hS(){var rG,rH;gC++;rG=fX;rH=iL();rH!==aK&&(fY=rG,rH=cY(rH));rG=rH;gC--;if(rG===aK){rH=aK;gC===0&&gP(cX)}return rG}function hT(){var rI,rJ,rK,rL;gC++;rI=fX;if(aI.substr(fX,2)===dA){rJ=dA;fX+=2}else{rJ=aK;gC===0&&gP(dB)}if(rJ!==aK){rK=[];rL=hY();if(rL!==aK)while (rL!==aK) {rK.push(rL);rL=hY()}else rK=aK;if(rK!==aK){if(aI.substr(fX,2)===dA){rL=dA;fX+=2}else{rL=aK;gC===0&&gP(dB)}rL!==aK?(fY=rI,rJ=dC(rK),rI=rJ):(fX=rI,rI=aK)}else{fX=rI;rI=aK}}else{fX=rI;rI=aK}gC--;if(rI===aK){rJ=aK;gC===0&&gP(cZ)}return rI}function hU(){var rM,rN;gC++;rM=fX;rN=iI();rN!==aK&&(fY=rM,rN=dE(rN));rM=rN;gC--;if(rM===aK){rN=aK;gC===0&&gP(dD)}return rM}function hV(){var rO,rP,rQ;gC++;rO=hW();if(rO===aK){rO=fX;rP=iW();rP===aK&&(rP=null);if(rP!==aK){rQ=iX();rQ!==aK?(rP=[rP,rQ],rO=rP):(fX=rO,rO=aK)}else{fX=rO;rO=aK}}gC--;if(rO===aK){rP=aK;gC===0&&gP(dF)}return rO}function hW(){var rR,rS,rT,rU;gC++;rR=fX;rS=iW();if(rS!==aK){rT=[];rU=hX();if(rU!==aK)while (rU!==aK) {rT.push(rU);rU=hX()}else rT=aK;rT!==aK?(rS=[rS,rT],rR=rS):(fX=rR,rR=aK)}else{fX=rR;rR=aK}gC--;if(rR===aK){rS=aK;gC===0&&gP(dG)}return rR}function hX(){var rV,rW,rX;gC++;rV=fX;rW=[];rX=iV();while (rX!==aK) {rW.push(rX);rX=iV()}if(rW!==aK){rX=iW();rX!==aK?(rW=[rW,rX],rV=rW):(fX=rV,rV=aK)}else{fX=rV;rV=aK}gC--;if(rV===aK){rW=aK;gC===0&&gP(dH)}return rV}function hY(){var rY,rZ,sA;gC++;rY=rZ=fX;gC++;if(aI.substr(fX,2)===dA){sA=dA;fX+=2}else{sA=aK;gC===0&&gP(dB)}gC--;sA===aK?rZ=void 0:fX=rZ;if(rZ!==aK){sA=iD();sA===aK&&(sA=iE());sA!==aK?(fY=rY,rZ=dJ(sA),rY=rZ):(fX=rY,rY=aK)}else{fX=rY;rY=aK}gC--;if(rY===aK){rZ=aK;gC===0&&gP(dI)}return rY}function hZ(){var sB;gC++;sB=iE();if(sB===aK){sB=iD();sB===aK&&(sB=iC())}gC--;if(sB===aK){gC===0&&gP(dK)}return sB}function iA(){var sC;gC++;sC=iF();if(sC===aK){sC=iD();sC===aK&&(sC=iC())}gC--;if(sC===aK){gC===0&&gP(dK)}return sC}function iB(){var sD,sE,sF,sG;gC++;sD=fX;if(aI.charCodeAt(fX)===91){sE=dM;fX++}else{sE=aK;gC===0&&gP(dN)}if(sE!==aK){if(aI.substr(fX,4)===dO){sF=dO;fX+=4}else{sF=aK;gC===0&&gP(dP)}if(sF===aK){if(aI.substr(fX,8)===dQ){sF=dQ;fX+=8}else{sF=aK;gC===0&&gP(dR)}if(sF===aK){if(aI.substr(fX,5)===dS){sF=dS;fX+=5}else{sF=aK;gC===0&&gP(dT)}if(sF===aK)if(aI.substr(fX,6)===dU){sF=dU;fX+=6}else{sF=aK;gC===0&&gP(dV)}}}if(sF!==aK){if(aI.charCodeAt(fX)===93){sG=dW;fX++}else{sG=aK;gC===0&&gP(dX)}sG!==aK?(fY=sD,sE=dY(sF),sD=sE):(fX=sD,sD=aK)}else{fX=sD;sD=aK}}else{fX=sD;sD=aK}gC--;if(sD===aK){sE=aK;gC===0&&gP(dL)}return sD}function iC(){var sH;gC++;if(aI.charCodeAt(fX)===92){sH=eA;fX++}else{sH=aK;gC===0&&gP(eB)}gC--;if(sH===aK){gC===0&&gP(dZ)}return sH}function iD(){var sI,sJ,sK;gC++;sI=fX;if(aI.charCodeAt(fX)===92){sJ=eA;fX++}else{sJ=aK;gC===0&&gP(eB)}if(sJ!==aK){if(aI.charCodeAt(fX)===92){sK=eA;fX++}else{sK=aK;gC===0&&gP(eB)}if(sK===aK){if(aI.charCodeAt(fX)===58){sK=cQ;fX++}else{sK=aK;gC===0&&gP(cR)}if(sK===aK){if(aI.charCodeAt(fX)===35){sK=bY;fX++}else{sK=aK;gC===0&&gP(bZ)}if(sK===aK){if(aI.charCodeAt(fX)===61){sK=y;fX++}else{sK=aK;gC===0&&gP(z)}if(sK===aK){if(aI.charCodeAt(fX)===123){sK=o;fX++}else{sK=aK;gC===0&&gP(P)}if(sK===aK){if(aI.charCodeAt(fX)===125){sK=q;fX++}else{sK=aK;gC===0&&gP(r)}if(sK===aK){if(aI.charCodeAt(fX)===126){sK=eD;fX++}else{sK=aK;gC===0&&gP(eE)}if(sK===aK)if(aI.charCodeAt(fX)===110){sK=eF;fX++}else{sK=aK;gC===0&&gP(eG)}}}}}}}sK!==aK?(fY=sI,sJ=eH(sK),sI=sJ):(fX=sI,sI=aK)}else{fX=sI;sI=aK}gC--;if(sI===aK){sJ=aK;gC===0&&gP(eC)}return sI}function iE(){var sL,sM,sN;gC++;sL=sM=fX;gC++;sN=iD();if(sN===aK){sN=iG();sN===aK&&(sN=hV())}gC--;sN===aK?sM=void 0:fX=sM;if(sM!==aK){if(aI.length>fX){sN=aI.charAt(fX);fX++}else{sN=aK;gC===0&&gP(eJ)}sN!==aK?(fY=sL,sM=eK(),sL=sM):(fX=sL,sL=aK)}else{fX=sL;sL=aK}gC--;if(sL===aK){sM=aK;gC===0&&gP(eI)}return sL}function iF(){var sO,sP,sQ;gC++;sO=sP=fX;gC++;sQ=iD();if(sQ===aK){sQ=iG();if(sQ===aK){if(aI.substr(fX,2)===aL){sQ=aL;fX+=2}else{sQ=aK;gC===0&&gP(aM)}sQ===aK&&(sQ=hV())}}gC--;sQ===aK?sP=void 0:fX=sP;if(sP!==aK){if(aI.length>fX){sQ=aI.charAt(fX);fX++}else{sQ=aK;gC===0&&gP(eJ)}sQ!==aK?(fY=sO,sP=eK(),sO=sP):(fX=sO,sO=aK)}else{fX=sO;sO=aK}gC--;if(sO===aK){sP=aK;gC===0&&gP(eI)}return sO}function iG(){var sR;if(aI.charCodeAt(fX)===61){sR=y;fX++}else{sR=aK;gC===0&&gP(z)}if(sR===aK){if(aI.charCodeAt(fX)===126){sR=eD;fX++}else{sR=aK;gC===0&&gP(eE)}if(sR===aK){if(aI.charCodeAt(fX)===35){sR=bY;fX++}else{sR=aK;gC===0&&gP(bZ)}if(sR===aK){if(aI.charCodeAt(fX)===123){sR=o;fX++}else{sR=aK;gC===0&&gP(P)}if(sR===aK){if(aI.charCodeAt(fX)===125){sR=q;fX++}else{sR=aK;gC===0&&gP(r)}if(sR===aK){if(aI.charCodeAt(fX)===92){sR=eA;fX++}else{sR=aK;gC===0&&gP(eB)}if(sR===aK)if(aI.charCodeAt(fX)===58){sR=cQ;fX++}else{sR=aK;gC===0&&gP(cR)}}}}}}return sR}function iH(){var sS,sT,sU,sV,sW;gC++;sS=fX;sT=iB();sT===aK&&(sT=null);if(sT!==aK){sU=iQ();if(sU!==aK){sV=[];sW=iA();if(sW!==aK)while (sW!==aK) {sV.push(sW);sW=iA()}else sV=aK;sV!==aK?(fY=sS,sT=eM(sT,sV),sS=sT):(fX=sS,sS=aK)}else{fX=sS;sS=aK}}else{fX=sS;sS=aK}gC--;if(sS===aK){sT=aK;gC===0&&gP(eL)}return sS}function iI(){var sX,sY,sZ,tA,tB;gC++;sX=fX;sY=iB();sY===aK&&(sY=null);if(sY!==aK){sZ=iQ();if(sZ!==aK){tA=[];tB=hZ();if(tB!==aK)while (tB!==aK) {tA.push(tB);tB=hZ()}else tA=aK;tA!==aK?(fY=sX,sY=eM(sY,tA),sX=sY):(fX=sX,sX=aK)}else{fX=sX;sX=aK}}else{fX=sX;sX=aK}gC--;if(sX===aK){sY=aK;gC===0&&gP(eN)}return sX}function iJ(){var tC,tD,tE;gC++;tC=fX;tD=[];tE=hZ();if(tE!==aK)while (tE!==aK) {tD.push(tE);tE=hZ()}else tD=aK;tD!==aK&&(fY=tC,tD=eP(tD));tC=tD;gC--;if(tC===aK){tD=aK;gC===0&&gP(eO)}return tC}function iK(){var tF,tG,tH,tI,tJ;gC++;tF=fX;tG=[];tH=tI=fX;gC++;tJ=iW();gC--;tJ===aK?tI=void 0:fX=tI;if(tI!==aK){if(aI.length>fX){tJ=aI.charAt(fX);fX++}else{tJ=aK;gC===0&&gP(eJ)}tJ!==aK?(tI=[tI,tJ],tH=tI):(fX=tH,tH=aK)}else{fX=tH;tH=aK}while (tH!==aK) {tG.push(tH);tH=tI=fX;gC++;tJ=iW();gC--;tJ===aK?tI=void 0:fX=tI;if(tI!==aK){if(aI.length>fX){tJ=aI.charAt(fX);fX++}else{tJ=aK;gC===0&&gP(eJ)}tJ!==aK?(tI=[tI,tJ],tH=tI):(fX=tH,tH=aK)}else{fX=tH;tH=aK}}if(tG!==aK){tH=fX;gC++;tI=iW();tI===aK&&(tI=iX());gC--;tI!==aK?(fX=tH,tH=void 0):(tH=aK);tH!==aK?(fY=tF,tG=eR(tG),tF=tG):(fX=tF,tF=aK)}else{fX=tF;tF=aK}gC--;if(tF===aK){tG=aK;gC===0&&gP(eQ)}return tF}function iL(){var tK,tL,tM;tK=fX;tL=iO();tL===aK&&(tL=null);if(tL!==aK){tM=iM();tM!==aK?(fY=tK,tL=eS(),tK=tL):(fX=tK,tK=aK)}else{fX=tK;tK=aK}return tK}function iM(){var tN,tO,tP,tQ,tR;tN=fX;tO=iN();if(tO!==aK){tP=fX;if(aI.charCodeAt(fX)===46){tQ=eT;fX++}else{tQ=aK;gC===0&&gP(eU)}if(tQ!==aK){tR=iN();tR!==aK?(tQ=[tQ,tR],tP=tQ):(fX=tP,tP=aK)}else{fX=tP;tP=aK}tP===aK&&(tP=null);tP!==aK?(tO=[tO,tP],tN=tO):(fX=tN,tN=aK)}else{fX=tN;tN=aK}return tN}function iN(){var tS,tT;tS=[];if(bS.test(aI.charAt(fX))){tT=aI.charAt(fX);fX++}else{tT=aK;gC===0&&gP(bT)}if(tT!==aK)while (tT!==aK) {tS.push(tT);if(bS.test(aI.charAt(fX))){tT=aI.charAt(fX);fX++}else{tT=aK;gC===0&&gP(bT)}}else tS=aK;return tS}function iO(){var tU;if(eV.test(aI.charAt(fX))){tU=aI.charAt(fX);fX++}else{tU=aK;gC===0&&gP(eW)}return tU}function iP(){var tV,tW,tX,tY,tZ;tV=fX;if(aI.substr(fX,4)===eX){tW=eX;fX+=4}else{tW=aK;gC===0&&gP(eY)}if(tW!==aK){tX=iQ();if(tX!==aK){tY=iI();if(tY!==aK){tZ=iQ();tZ!==aK?(fY=tV,tW=eZ(tY),tV=tW):(fX=tV,tV=aK)}else{fX=tV;tV=aK}}else{fX=tV;tV=aK}}else{fX=tV;tV=aK}return tV}function iQ(){var uA,uB,uC,uD,uE;gC++;uA=[];uB=iV();if(uB===aK){uB=fX;uC=iW();if(uC!==aK){uD=fX;gC++;uE=hX();gC--;uE===aK?uD=void 0:fX=uD;uD!==aK?(uC=[uC,uD],uB=uC):(fX=uB,uB=aK)}else{fX=uB;uB=aK}}while (uB!==aK) {uA.push(uB);uB=iV();if(uB===aK){uB=fX;uC=iW();if(uC!==aK){uD=fX;gC++;uE=hX();gC--;uE===aK?uD=void 0:fX=uD;uD!==aK?(uC=[uC,uD],uB=uC):(fX=uB,uB=aK)}else{fX=uB;uB=aK}}}gC--;if(uA===aK){uB=aK;gC===0&&gP(fA)}return uA}function iR(){var uF,uG;gC++;uF=[];uG=iU();if(uG===aK){uG=iW();uG===aK&&(uG=iV())}while (uG!==aK) {uF.push(uG);uG=iU();if(uG===aK){uG=iW();uG===aK&&(uG=iV())}}gC--;if(uF===aK){uG=aK;gC===0&&gP(fB)}return uF}function iS(){var uH,uI,uJ,uK;uH=uI=fX;gC++;uJ=[];if(aI.charCodeAt(fX)===32){uK=fC;fX++}else{uK=aK;gC===0&&gP(fD)}while (uK!==aK) {uJ.push(uK);if(aI.charCodeAt(fX)===32){uK=fC;fX++}else{uK=aK;gC===0&&gP(fD)}}gC--;uJ!==aK?(fX=uI,uI=void 0):(uI=aK);uI!==aK&&(fY=uH,uI=fE());uH=uI;return uH}function iT(){var uL,uM,uN,uO;gC++;uL=fX;if(aI.substr(fX,2)===fG){uM=fG;fX+=2}else{uM=aK;gC===0&&gP(fH)}if(uM!==aK){uN=[];if(fI.test(aI.charAt(fX))){uO=aI.charAt(fX);fX++}else{uO=aK;gC===0&&gP(fJ)}while (uO!==aK) {uN.push(uO);if(fI.test(aI.charAt(fX))){uO=aI.charAt(fX);fX++}else{uO=aK;gC===0&&gP(fJ)}}uN!==aK?(fY=uL,uM=fK(uN),uL=uM):(fX=uL,uL=aK)}else{fX=uL;uL=aK}gC--;if(uL===aK){uM=aK;gC===0&&gP(fF)}return uL}function iU(){var uP,uQ,uR,uS;gC++;uP=fX;if(aI.substr(fX,2)===fG){uQ=fG;fX+=2}else{uQ=aK;gC===0&&gP(fH)}if(uQ!==aK){uR=[];if(fI.test(aI.charAt(fX))){uS=aI.charAt(fX);fX++}else{uS=aK;gC===0&&gP(fJ)}while (uS!==aK) {uR.push(uS);if(fI.test(aI.charAt(fX))){uS=aI.charAt(fX);fX++}else{uS=aK;gC===0&&gP(fJ)}}uR!==aK?(fY=uP,uQ=fL(uR),uP=uQ):(fX=uP,uP=aK)}else{fX=uP;uP=aK}gC--;if(uP===aK){uQ=aK;gC===0&&gP(fF)}return uP}function iV(){var uT;gC++;if(aI.charCodeAt(fX)===32){uT=fC;fX++}else{uT=aK;gC===0&&gP(fD)}if(uT===aK)if(aI.charCodeAt(fX)===9){uT=fN;fX++}else{uT=aK;gC===0&&gP(fO)}gC--;if(uT===aK){gC===0&&gP(fM)}return uT}function iW(){var uU;gC++;if(aI.substr(fX,2)===fQ){uU=fQ;fX+=2}else{uU=aK;gC===0&&gP(fR)}if(uU===aK){if(aI.charCodeAt(fX)===10){uU=fS;fX++}else{uU=aK;gC===0&&gP(fT)}if(uU===aK)if(aI.charCodeAt(fX)===13){uU=fU;fX++}else{uU=aK;gC===0&&gP(fV)}}gC--;if(uU===aK){gC===0&&gP(fP)}return uU}function iX(){var uV,uW,uX;uV=uW=fX;gC++;if(aI.length>fX){uX=aI.charAt(fX);fX++}else{uX=aK;gC===0&&gP(eJ)}gC--;uX===aK?uW=void 0:fX=uW;uW!==aK&&(fY=uV,uW=fW());uV=uW;return uV}var iY=null,iZ=null,jA='moodle',jB=jA,jC={'\\\\':'&&092;','\\:':'&&058;','\\#':'&&035;','\\=':'&&061;','\\{':'&&123;','\\}':'&&125;','\\~':'&&126;','\\n':'&&010'};function jD(uY){return uY.replaceAll('&&092;','\\').replaceAll('&&058;',':').replaceAll('&&035;','#').replaceAll('&&061;','=').replaceAll('&&123;','{').replaceAll('&&125;','}').replaceAll('&&126;','~').replaceAll('&&010','\n')}function jE(uZ,vA){uZ.globalFeedback=vA.globalFeedback;switch(uZ.type) {case 'TF':uZ.isTrue=vA.isTrue;uZ.trueFeedback=vA.feedback[0];uZ.falseFeedback=vA.feedback[1];break;case 'MC':case 'Numerical':case 'Short':uZ.choices=vA.choices;break;case 'Matching':uZ.matchPairs=vA.matchPairs;break}(uZ.type=='MC'&&jF(uZ.choices))&&(uZ.type='Short');uZ.id=iY;uZ.tags=iZ;return uZ}function jF(vB){var vC=!0;for(var i=0;i<vB.length;i++)vC&=vB[i].isCorrect;return vC}function jG(vD){vD=vD.replace(/[\n\r]/g,' ');return vD.replace(/\s\s+/g,' ')}function jH(vE){jB=vE}function jI(){return jB}function jJ(){jB=jA}function jK(vF,vG){let vH=(vF!==null?vF:jI());let vI=vG.join('').replace(/\r\n/g,'\n').trim();return{format:(vH),text:(((vH=='html')||(vH=='markdown'))?jD(vI):jD(jG(vI)))}}gD=_e();if(gD!==aK&&fX===aI.length)return gD;(gD!==aK&&fX<aI.length)&&gP(gL());throw gR(gB,gA<aI.length?aI.charAt(gA):null,gA<aI.length?gO(gA,gA+1):gO(gA,gA))}module.exports={SyntaxError:c,parse:d};
