"use strict";var{isArray:a}=Array;function b(A,_){function B(){this.constructor=A}B.prototype=_.prototype;A.prototype=new B()}function c(A,_,B,D){this.message=A;this.expected=_;this.found=B;this.location=D;this.name="SyntaxError";Error.captureStackTrace?.(this,c)}b(c,Error);c.buildMessage=(A,_)=>{var B={literal:function(C){return`"${e(C.text)}"`},"class":function(C){var _b="",i;for(i=0;i<C.parts.length;i++)_b+=a(C.parts[i])?f(C.parts[i][0])+"-"+f(C.parts[i][1]):f(C.parts[i]);return "["+(C.inverted?"^":"")+_b+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(C){return C.description}};function D(C){return C.charCodeAt(0).toString(16).toUpperCase()}function e(s){return s.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\0/g,'\\0').replace(/\t/g,'\\t').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/[\x00-\x0F]/g,function(C){return '\\x0'+D(C)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(C){return '\\x'+D(C)})}function f(s){return s.replace(/\\/g,'\\\\').replace(/\]/g,'\\]').replace(/\^/g,'\\^').replace(/-/g,'\\-').replace(/\0/g,'\\0').replace(/\t/g,'\\t').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/[\x00-\x0F]/g,function(C){return '\\x0'+D(C)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(C){return '\\x'+D(C)})}function g(C){return B[C.type](C)}function h(C){var _b=Array(C.length),i,j;for(i=0;i<C.length;i++)_b[i]=g(C[i]);_b.sort();if(_b.length>0){for((i=1,j=1);i<_b.length;i++)_b[i-1]!==_b[i]&&(_b[j]=_b[i],j++);_b.length=j}switch(_b.length) {case 1:return _b[0];case 2:return _b[0]+" or "+_b[1];default:return _b.slice(0,-1).join(", ")+", or "+_b[_b.length-1]}}function i(C){return C?`"${e(C)}"`:"end of input"}return "Expected "+h(A)+" but "+i(_)+" found."};function d(A,_){_=_!==void 0?_:{};var B={},D={GIFTQuestions:fY},f=function(C){return C},g=fT("Category"),h="$",i=fP("$",!1),j="CATEGORY:",k=fP("CATEGORY:",!1),l=function(C){return{type:"Category",title:C}},m=fT("Description"),n=function(C,_b){var _c={id:iE,tags:iF,type:"Description",title:C,stem:_b,hasEmbeddedAnswers:!1};iP();iE=null;iF=null;return _c},o="{",p=fP("{",!1),q="}",r=fP("}",!1),s=function(C,_b,_c,_d){var E=(_d!==null),F=_b?(_b.text+(E?" ":"")):"",G=_b?.format||_d?.format||"moodle",H=F+(E?"_____ "+_d.text:""),I={type:_c.type,title:C,stem:{format:G,text:H},hasEmbeddedAnswers:E};I=iK(I,_c);iP();return I},t=fT("{= match1 -> Match1\n...}"),u=function(C,_b){return{type:"Matching",matchPairs:C,globalFeedback:_b}},v=fT("matches"),w=function(C){return C},x=fT("match"),y="=",z=fP("=",!1),aA="->",aB=fP("->",!1),aC=function(C,_b){var _c={subquestion:{format:(C!==null?C.format:iO()),text:(C!==null?C.text:"")},subanswer:_b};return _c},aD=fT("{T} or {F} or {TRUE} or {FALSE}"),aE=function(C,_b,_c){return{type:"TF",isTrue:C,feedback:_b,globalFeedback:_c}},aF=function(C){return C},aG="TRUE",aH=fP("TRUE",!1),aI="T",aJ=fP("T",!1),aK=function(){return!0},aL="FALSE",aM=fP("FALSE",!1),aN="F",aO=fP("F",!1),aP=function(){return!1},aQ=fT("{=correct choice ~incorrect choice ... }"),aR=function(C,_b){return{type:"MC",choices:C,globalFeedback:_b}},aS=fT("Choices"),aT=function(C){return C},aU=fT("Choice"),aV=/^[=~]/,aW=fQ(["=","~"],!1,!1),aX=function(C,_b){var _c=C[2],_d=C[4],C={isCorrect:(C[0]=='='),weight:_c,text:_d,feedback:_b};return C},aY=fT("(weight)"),aZ="%",bA=fP("%",!1),bB=function(C){return C},bC=fT("(percent)"),bD=fR(),bE=function(C){let _b='a value between -100 and 100';console.log(C.length);!C.length&&fO(`${_b} (did you forget to put a value?)`);var _c=parseFloat(C.map(innerArray=>innerArray[1]).join(""));console.log(_c);if(_c>=-100&&_c<=100)return _c;fO(_b)},bF=fT("(feedback)"),bG="#",bH=fP("#",!1),bI="###",bJ=fP("###",!1),bK=function(C){return C},bL=fT("Essay question { ... }"),bM="",bN=function(C){return{type:"Essay",globalFeedback:C}},bO=fT("Single short answer { ... }"),bP=function(C,_b,_c){var _d=[];_d.push({isCorrect:!0,text:C,feedback:_b,weight:null});return{type:"Short",choices:_d,globalFeedback:_c}},bQ=fT("{#... }"),bR=function(C,_b){return{type:"Numerical",choices:C,globalFeedback:_b}},bS=fT("Numerical Answers"),bT=fT("Multiple Numerical Choices"),bU=fT("Numerical Choice"),bV=function(C,_b){var _c=C[0],_d=C[1],E=C[2],C={isCorrect:(_c=='='),weight:_d,text:(E!==null?E:{format:iO(),text:'*'}),feedback:_b};return C},bW=fT("Single numeric answer"),bX=fT("(number with range)"),bY=":",bZ=fP(":",!1),cA=function(C,_b){return{type:'range',number:C,range:_b}},cB=fT("(number with high-low)"),cC="..",cD=fP("..",!1),cE=function(C,_b){return{type:'high-low',numberHigh:_b,numberLow:C}},cF=fT("(number answer)"),cG=function(C){return{type:'simple',number:C}},cH=fT(":: Title ::"),cI="::",cJ=fP("::",!1),cK=function(C){return iJ(C.join(''))},cL=fT("Question stem"),cM=function(C){iN(C.format);return C},cN=fT("(blank lines separator)"),cO=fT("(blank lines)"),cP=fT("blank line"),cQ=fT("(Title text)"),cR=function(t){return t},cS=fT("(text character)"),cT=fT("format"),cU="[",cV=fP("[",!1),cW="html",cX=fP("html",!1),cY="markdown",cZ=fP("markdown",!1),dA="plain",dB=fP("plain",!1),dC="moodle",dD=fP("moodle",!1),dE="]",dF=fP("]",!1),dG=function(C){return C},dH=fT("(escape character)"),dI="\\",dJ=fP("\\",!1),dK=fT("escape sequence"),dL="~",dM=fP("~",!1),dN="n",dO=fP("n",!1),dP=function(C){return iI[`\${C}`]},dQ=fT(""),dR=function(){return fN()},dS=fT("(formatted text excluding '->')"),dT=function(C,_b){return iQ(C,_b)},dU=fT("(formatted text)"),dV=fT("(unformatted text)"),dW=function(C){return iM(C.join('').trim())},dX=fT("(category text)"),dY=function(C){return C.flat().join('')},dZ=function(){return parseFloat(fN())},eA=".",eB=fP(".",!1),eC=/^\d/,eD=fQ([["0","9"]],!1,!1),eE=/^[+\-]/,eF=fQ(["+","-"],!1,!1),eG="####",eH=fP("####",!1),eI=function(C){return C},eJ=fT("(single line whitespace)"),eK=fT("(multiple line whitespace)"),eL=" ",eM=fP(" ",!1),eN=function(){iE=null;iF=null},eO=fT("(comment)"),eP="//",eQ=fP("//",!1),eR=/^[^\n\r]/,eS=fQ(["\n","\r"],!0,!1),eT=function(){return null},eU=function(p){var C=p.join(""),_c=C.match(/\[id:([^\x00-\x1F\x7F]+?)]/);_c&&(iE=_c[1].trim().replace('\\]',']'));Array.from(C.matchAll(/\[tag:([^\x00-\x1F\x7F]+?)]/g),function(m){return m[1]}).forEach(_a=>{!iF&&(iF=[]);iF.push(_a)});return null},eV=fT("(space)"),eW="\t",eX=fP("\t",!1),eY=fT("(end of line)"),eZ="\r\n",fA=fP("\r\n",!1),fB="\n",fC=fP("\n",!1),fD="\r",fE=fP("\r",!1),fF=function(){return"EOF"},fG=0,fH=0,fI=[{line:1,column:1}],fJ=0,fK=[],fL=0,fM;if("startRule" in _){if(!(_.startRule in D))throw Error("Can't start parsing from rule \""+_.startRule+"\".");e=D[_.startRule]}function fN(){return A.substring(fH,fG)}function fO(C,_b){_b=_b!==void 0?_b:fV(fH,fG);throw fX([fT(C)],A.substring(fH,fG),_b)}function fP(C,_b){return{type:"literal",text:C,ignoreCase:_b}}function fQ(C,_b,_c){return{type:"class",parts:C,inverted:_b,ignoreCase:_c}}function fR(){return{type:"any"}}function fS(){return{type:"end"}}function fT(C){return{type:"other",description:C}}function fU(C){var _b=fI[C],p;if(_b)return _b;p=C-1;while (!fI[p])p--;_b=fI[p];_b={line:_b.line,column:_b.column};while (p<C) {A.charCodeAt(p)==10?(_b.line++,_b.column=1):(_b.column++);p++}fI[C]=_b;return _b}function fV(C,_b){var _c=fU(C),_d=fU(_b);return{start:{offset:C,line:_c.line,column:_c.column},end:{offset:_b,line:_d.line,column:_d.column}}}function fW(C){if(fG<fJ)return;fG>fJ&&(fJ=fG,fK=[]);fK.push(C)}function fX(C,_b,_c){return new c(c.buildMessage(C,_b), C, _b, _c)}function fY(){var C,_b,_c,_d;C=fG;_b=[];_c=fZ();_c==B&&(_c=gA(),_c==B&&(_c=gB()));if(_c!==B)while (_c!==B) {_b.push(_c);_c=fZ();_c==B&&(_c=gA(),_c==B&&(_c=gB()))}else _b=B;_b!==B?(_c=hW(),_c!==B?(_d=hX(),_d!==B?(fH=C,_b=f(_b),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);return C}function fZ(){var C,_b,_c,_d,E,F,G,H;fL++;C=fG;_b=hY();if(_b!==B){_c=hX();if(_c!==B){A.charCodeAt(fG)==36?(_d=h,fG++):(_d=B,!fL&&fW(i));if(_d!==B){A.substr(fG,9)==j?(E=j,fG+=9):(E=B,!fL&&fW(k));E!==B?(F=hW(),F!==B?(G=hQ(),G!==B?(H=hB(),H!==B?(fH=C,_b=l(G),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(g));return C}function gA(){var C,_b,_c,_d,E,F,G,H;fL++;C=fG;_b=hY();if(_b!==B){_c=hX();if(_c!==B){_d=[];E=iA();while (E!==B) {_d.push(E);E=iA()}if(_d!==B){E=gZ();E==B&&(E=null);E!==B?(F=hW(),F!==B?(G=hA(),G!==B?(H=hB(),H!==B?(fH=C,_b=n(E,G),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(m));return C}function gB(){var C,_b,_c,_d,E,F,G,H,I,J,K,L,M,N,O,P;C=fG;_b=hY();if(_b!==B){_c=hX();if(_c!==B){_d=[];E=iA();while (E!==B) {_d.push(E);E=iA()}if(_d!==B){E=gZ();E==B&&(E=null);if(E!==B){F=hW();if(F!==B){G=hA();G==B&&(G=null);if(G!==B){H=hW();if(H!==B){A.charCodeAt(fG)==123?(I=o,fG++):(I=B,!fL&&fW(p));if(I!==B){J=hW();if(J!==B){K=gC();if(K==B){K=gF();K==B&&(K=gJ(),K==B&&(K=gR(),K==B&&(K=gQ(),K==B&&(K=gP()))))}if(K!==B){L=hW();if(L!==B){A.charCodeAt(fG)==125?(M=q,fG++):(M=B,!fL&&fW(r));M!==B?(N=hW(),N!==B?(O=hZ(),O==B&&(O=hA()),O==B&&(O=null),O!==B?(P=hB(),P!==B?(fH=C,_b=s(E,G,K,O),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}return C}function gC(){var C,_b,_c,_d,E;fL++;C=fG;_b=gD();_b!==B?(_c=hW(),_c!==B?(_d=hV(),_d==B&&(_d=null),_d!==B?(E=hW(),E!==B?(fH=C,_b=u(_b,_d),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(t));return C}function gD(){var C,_b,_c;fL++;C=fG;_b=[];_c=gE();if(_c!==B)while (_c!==B) {_b.push(_c);_c=gE()}else _b=B;_b!==B&&(fH=C,_b=w(_b));C=_b;fL--;C==B&&(_b=B,!fL&&fW(v));return C}function gE(){var C,_b,_c,_d,E,F,G,H,I,J;fL++;C=fG;_b=hW();if(_b!==B){A.charCodeAt(fG)==61?(_c=y,fG++):(_c=B,!fL&&fW(z));if(_c!==B){_d=hW();if(_d!==B){E=hN();E==B&&(E=null);if(E!==B){F=hW();if(F!==B){A.substr(fG,2)==aA?(G=aA,fG+=2):(G=B,!fL&&fW(aB));G!==B?(H=hW(),H!==B?(I=hP(),I!==B?(J=hW(),J!==B?(fH=C,_b=aC(E,I),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(x));return C}function gF(){var C,_b,_c,_d,E,F;fL++;C=fG;_b=gG();if(_b!==B){_c=hW();_c!==B?(_d=fG,E=gO(),E==B&&(E=null),E!==B?(F=gO(),F==B&&(F=null),F!==B?(E=[E,F],_d=E):(fG=_d,_d=B)):(fG=_d,_d=B),_d!==B?(E=hW(),E!==B?(F=hV(),F==B&&(F=null),F!==B?(fH=C,_b=aE(_b,_d,F),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(aD));return C}function gG(){var C,_b;C=fG;_b=gH();_b==B&&(_b=gI());_b!==B&&(fH=C,_b=aF(_b));C=_b;return C}function gH(){var C,_b;C=fG;A.substr(fG,4)==aG?(_b=aG,fG+=4):(_b=B,!fL&&fW(aH));_b==B&&A.charCodeAt(fG)==84?(_b=aI,fG++):(_b=B,!fL&&fW(aJ));_b!==B&&(fH=C,_b=aK());C=_b;return C}function gI(){var C,_b;C=fG;A.substr(fG,5)==aL?(_b=aL,fG+=5):(_b=B,!fL&&fW(aM));_b==B&&A.charCodeAt(fG)==70?(_b=aN,fG++):(_b=B,!fL&&fW(aO));_b!==B&&(fH=C,_b=aP());C=_b;return C}function gJ(){var C,_b,_c,_d,E;fL++;C=fG;_b=gK();_b!==B?(_c=hW(),_c!==B?(_d=hV(),_d==B&&(_d=null),_d!==B?(E=hW(),E!==B?(fH=C,_b=aR(_b,_d),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(aQ));return C}function gK(){var C,_b,_c;fL++;C=fG;_b=[];_c=gL();if(_c!==B)while (_c!==B) {_b.push(_c);_c=gL()}else _b=B;_b!==B&&(fH=C,_b=aT(_b));C=_b;fL--;C==B&&(_b=B,!fL&&fW(aS));return C}function gL(){var C,_b,_c,_d,E,F,G,H;fL++;C=fG;_b=hW();if(_b!==B){_c=fG;aV.test(A.charAt(fG))?(_d=A.charAt(fG),fG++):(_d=B,!fL&&fW(aW));if(_d!==B){E=hW();E!==B?(F=gM(),F==B&&(F=null),F!==B?(G=hW(),G!==B?(H=hO(),H!==B?(_d=[_d,E,F,G,H],_c=_d):(fG=_c,_c=B)):(fG=_c,_c=B)):(fG=_c,_c=B)):(fG=_c,_c=B)}else{fG=_c;_c=B}_c!==B?(_d=gO(),_d==B&&(_d=null),_d!==B?(E=hW(),E!==B?(fH=C,_b=aX(_c,_d),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(aU));return C}function gM(){var C,_b,_c,_d;fL++;C=fG;A.charCodeAt(fG)==37?(_b=aZ,fG++):(_b=B,!fL&&fW(bA));_b!==B?(_c=gN(),_c!==B?(A.charCodeAt(fG)==37?(_d=aZ,fG++):(_d=B,!fL&&fW(bA)),_d!==B?(fH=C,_b=bB(_c),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(aY));return C}function gN(){var C,_b,_c,_d,E;fL++;C=fG;_b=[];_c=fG;_d=fG;fL++;A.charCodeAt(fG)==37?(E=aZ,fG++):(E=B,!fL&&fW(bA));fL--;E==B?_d=void 0:fG=_d;_d!==B?(A.length>fG?(E=A.charAt(fG),fG++):(E=B,!fL&&fW(bD)),E!==B?(_d=[_d,E],_c=_d):(fG=_c,_c=B)):(fG=_c,_c=B);while (_c!==B) {_b.push(_c);_c=fG;_d=fG;fL++;A.charCodeAt(fG)==37?(E=aZ,fG++):(E=B,!fL&&fW(bA));fL--;E==B?_d=void 0:fG=_d;_d!==B?(A.length>fG?(E=A.charAt(fG),fG++):(E=B,!fL&&fW(bD)),E!==B?(_d=[_d,E],_c=_d):(fG=_c,_c=B)):(fG=_c,_c=B)}_b!==B&&(fH=C,_b=bE(_b));C=_b;fL--;C==B&&(_b=B,!fL&&fW(bC));return C}function gO(){var C,_b,_c,_d,E;fL++;C=fG;A.charCodeAt(fG)==35?(_b=bG,fG++):(_b=B,!fL&&fW(bH));_b!==B?(_c=fG,fL++,A.substr(fG,3)==bI?(_d=bI,fG+=3):(_d=B,!fL&&fW(bJ)),fL--,_d==B?_c=void 0:fG=_c,_c!==B?(_d=hW(),_d!==B?(E=hO(),E==B&&(E=null),E!==B?(fH=C,_b=bK(E),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(bF));return C}function gP(){var C,_b,_c,_d,E;fL++;C=fG;_b=bM;_b!==B?(_c=hW(),_c!==B?(_d=hV(),_d==B&&(_d=null),_d!==B?(E=hW(),E!==B?(fH=C,_b=bN(_d),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(bL));return C}function gQ(){var C,_b,_c,_d,E,F,G;fL++;C=fG;_b=hO();if(_b!==B){_c=hW();if(_c!==B){_d=gO();_d==B&&(_d=null);_d!==B?(E=hW(),E!==B?(F=hV(),F==B&&(F=null),F!==B?(G=hW(),G!==B?(fH=C,_b=bP(_b,_d,F),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(bO));return C}function gR(){var C,_b,_c,_d,E,F;fL++;C=fG;A.charCodeAt(fG)==35?(_b=bG,fG++):(_b=B,!fL&&fW(bH));if(_b!==B){_c=hW();_c!==B?(_d=gS(),_d!==B?(E=hW(),E!==B?(F=hV(),F==B&&(F=null),F!==B?(fH=C,_b=bR(_d,F),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(bQ));return C}function gS(){var C;fL++;C=gT();C==B&&(C=gV());fL--;C==B&&!fL&&fW(bS);return C}function gT(){var C,_b,_c;fL++;C=fG;_b=[];_c=gU();if(_c!==B)while (_c!==B) {_b.push(_c);_c=gU()}else _b=B;_b!==B&&(fH=C,_b=aT(_b));C=_b;fL--;C==B&&(_b=B,!fL&&fW(bT));return C}function gU(){var C,_b,_c,_d,E,F;fL++;C=fG;_b=hW();if(_b!==B){_c=fG;aV.test(A.charAt(fG))?(_d=A.charAt(fG),fG++):(_d=B,!fL&&fW(aW));_d!==B?(E=gM(),E==B&&(E=null),E!==B?(F=gV(),F==B&&(F=null),F!==B?(_d=[_d,E,F],_c=_d):(fG=_c,_c=B)):(fG=_c,_c=B)):(fG=_c,_c=B);_c!==B?(_d=hW(),_d!==B?(E=gO(),E==B&&(E=null),E!==B?(F=hW(),F!==B?(fH=C,_b=bV(_c,E),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(bU));return C}function gV(){var C;fL++;C=gW();C==B&&(C=gX(),C==B&&(C=gY()));fL--;C==B&&!fL&&fW(bW);return C}function gW(){var C,_b,_c,_d;fL++;C=fG;_b=hR();_b!==B?(A.charCodeAt(fG)==58?(_c=bY,fG++):(_c=B,!fL&&fW(bZ)),_c!==B?(_d=hR(),_d!==B?(fH=C,_b=cA(_b,_d),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(bX));return C}function gX(){var C,_b,_c,_d;fL++;C=fG;_b=hR();_b!==B?(A.substr(fG,2)==cC?(_c=cC,fG+=2):(_c=B,!fL&&fW(cD)),_c!==B?(_d=hR(),_d!==B?(fH=C,_b=cE(_b,_d),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(cB));return C}function gY(){var C,_b;fL++;C=fG;_b=hR();_b!==B&&(fH=C,_b=cG(_b));C=_b;fL--;C==B&&(_b=B,!fL&&fW(cF));return C}function gZ(){var C,_b,_c,_d;fL++;C=fG;A.substr(fG,2)==cI?(_b=cI,fG+=2):(_b=B,!fL&&fW(cJ));if(_b!==B){_c=[];_d=hE();if(_d!==B)while (_d!==B) {_c.push(_d);_d=hE()}else _c=B;_c!==B?(A.substr(fG,2)==cI?(_d=cI,fG+=2):(_d=B,!fL&&fW(cJ)),_d!==B?(fH=C,_b=cK(_c),C=_b):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(cH));return C}function hA(){var C,_b;fL++;C=fG;_b=hO();_b!==B&&(fH=C,_b=cM(_b));C=_b;fL--;C==B&&(_b=B,!fL&&fW(cL));return C}function hB(){var C,_b,_c;fL++;C=hC();C==B&&(C=fG,_b=iC(),_b==B&&(_b=null),_b!==B?(_c=iD(),_c!==B?(_b=[_b,_c],C=_b):(fG=C,C=B)):(fG=C,C=B));fL--;C==B&&(_b=B,!fL&&fW(cN));return C}function hC(){var C,_b,_c,_d;fL++;C=fG;_b=iC();if(_b!==B){_c=[];_d=hD();if(_d!==B)while (_d!==B) {_c.push(_d);_d=hD()}else _c=B;_c!==B?(_b=[_b,_c],C=_b):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(cO));return C}function hD(){var C,_b,_c;fL++;C=fG;_b=[];_c=iB();while (_c!==B) {_b.push(_c);_c=iB()}_b!==B?(_c=iC(),_c!==B?(_b=[_b,_c],C=_b):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(cP));return C}function hE(){var C,_b,_c;fL++;C=fG;_b=fG;fL++;A.substr(fG,2)==cI?(_c=cI,fG+=2):(_c=B,!fL&&fW(cJ));fL--;_c==B?_b=void 0:fG=_b;_b!==B?(_c=hJ(),_c==B&&(_c=hK()),_c!==B?(fH=C,_b=cR(_c),C=_b):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(cQ));return C}function hF(){var C;fL++;C=hK();C==B&&(C=hJ(),C==B&&(C=hI()));fL--;C==B&&!fL&&fW(cS);return C}function hG(){var C;fL++;C=hL();C==B&&(C=hJ(),C==B&&(C=hI()));fL--;C==B&&!fL&&fW(cS);return C}function hH(){var C,_b,_c,_d;fL++;C=fG;A.charCodeAt(fG)==91?(_b=cU,fG++):(_b=B,!fL&&fW(cV));if(_b!==B){A.substr(fG,4)==cW?(_c=cW,fG+=4):(_c=B,!fL&&fW(cX));if(_c==B){A.substr(fG,8)==cY?(_c=cY,fG+=8):(_c=B,!fL&&fW(cZ));_c==B&&(A.substr(fG,5)==dA?(_c=dA,fG+=5):(_c=B,!fL&&fW(dB)),_c==B&&A.substr(fG,6)==dC?(_c=dC,fG+=6):(_c=B,!fL&&fW(dD)))}_c!==B?(A.charCodeAt(fG)==93?(_d=dE,fG++):(_d=B,!fL&&fW(dF)),_d!==B?(fH=C,_b=dG(_c),C=_b):(fG=C,C=B)):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(cT));return C}function hI(){var C;fL++;A.charCodeAt(fG)==92?(C=dI,fG++):(C=B,!fL&&fW(dJ));fL--;C==B&&!fL&&fW(dH);return C}function hJ(){var C,_b,_c;fL++;C=fG;A.charCodeAt(fG)==92?(_b=dI,fG++):(_b=B,!fL&&fW(dJ));if(_b!==B){A.charCodeAt(fG)==92?(_c=dI,fG++):(_c=B,!fL&&fW(dJ));if(_c==B){A.charCodeAt(fG)==58?(_c=bY,fG++):(_c=B,!fL&&fW(bZ));if(_c==B){A.charCodeAt(fG)==35?(_c=bG,fG++):(_c=B,!fL&&fW(bH));if(_c==B){A.charCodeAt(fG)==61?(_c=y,fG++):(_c=B,!fL&&fW(z));if(_c==B){A.charCodeAt(fG)==123?(_c=o,fG++):(_c=B,!fL&&fW(p));if(_c==B){A.charCodeAt(fG)==125?(_c=q,fG++):(_c=B,!fL&&fW(r));_c==B&&(A.charCodeAt(fG)==126?(_c=dL,fG++):(_c=B,!fL&&fW(dM)),_c==B&&A.charCodeAt(fG)==110?(_c=dN,fG++):(_c=B,!fL&&fW(dO)))}}}}}_c!==B?(fH=C,_b=dP(_c),C=_b):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(dK));return C}function hK(){var C,_b,_c;fL++;C=fG;_b=fG;fL++;_c=hJ();_c==B&&(_c=hM(),_c==B&&(_c=hB()));fL--;_c==B?_b=void 0:fG=_b;_b!==B?(A.length>fG?(_c=A.charAt(fG),fG++):(_c=B,!fL&&fW(bD)),_c!==B?(fH=C,_b=dR(),C=_b):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(dQ));return C}function hL(){var C,_b,_c;fL++;C=fG;_b=fG;fL++;_c=hJ();_c==B&&(_c=hM(),_c==B&&(A.substr(fG,2)==aA?(_c=aA,fG+=2):(_c=B,!fL&&fW(aB)),_c==B&&(_c=hB())));fL--;_c==B?_b=void 0:fG=_b;_b!==B?(A.length>fG?(_c=A.charAt(fG),fG++):(_c=B,!fL&&fW(bD)),_c!==B?(fH=C,_b=dR(),C=_b):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(dQ));return C}function hM(){var C;A.charCodeAt(fG)==61?(C=y,fG++):(C=B,!fL&&fW(z));if(C==B){A.charCodeAt(fG)==126?(C=dL,fG++):(C=B,!fL&&fW(dM));if(C==B){A.charCodeAt(fG)==35?(C=bG,fG++):(C=B,!fL&&fW(bH));if(C==B){A.charCodeAt(fG)==123?(C=o,fG++):(C=B,!fL&&fW(p));if(C==B){A.charCodeAt(fG)==125?(C=q,fG++):(C=B,!fL&&fW(r));C==B&&(A.charCodeAt(fG)==92?(C=dI,fG++):(C=B,!fL&&fW(dJ)),C==B&&A.charCodeAt(fG)==58?(C=bY,fG++):(C=B,!fL&&fW(bZ)))}}}}return C}function hN(){var C,_b,_c,_d,E;fL++;C=fG;_b=hH();_b==B&&(_b=null);if(_b!==B){_c=hW();if(_c!==B){_d=[];E=hG();if(E!==B)while (E!==B) {_d.push(E);E=hG()}else _d=B;_d!==B?(fH=C,_b=dT(_b,_d),C=_b):(fG=C,C=B)}else{fG=C;C=B}}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(dS));return C}function hO(){var C,_b,_c,_d,E;fL++;C=fG;_b=hH();_b==B&&(_b=null);if(_b!==B){_c=hW();if(_c!==B){_d=[];E=hF();if(E!==B)while (E!==B) {_d.push(E);E=hF()}else _d=B;_d!==B?(fH=C,_b=dT(_b,_d),C=_b):(fG=C,C=B)}else{fG=C;C=B}}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(dU));return C}function hP(){var C,_b,_c;fL++;C=fG;_b=[];_c=hF();if(_c!==B)while (_c!==B) {_b.push(_c);_c=hF()}else _b=B;_b!==B&&(fH=C,_b=dW(_b));C=_b;fL--;C==B&&(_b=B,!fL&&fW(dV));return C}function hQ(){var C,_b,_c,_d,E;fL++;C=fG;_b=[];_c=fG;_d=fG;fL++;E=iC();fL--;E==B?_d=void 0:fG=_d;_d!==B?(A.length>fG?(E=A.charAt(fG),fG++):(E=B,!fL&&fW(bD)),E!==B?(_d=[_d,E],_c=_d):(fG=_c,_c=B)):(fG=_c,_c=B);while (_c!==B) {_b.push(_c);_c=fG;_d=fG;fL++;E=iC();fL--;E==B?_d=void 0:fG=_d;_d!==B?(A.length>fG?(E=A.charAt(fG),fG++):(E=B,!fL&&fW(bD)),E!==B?(_d=[_d,E],_c=_d):(fG=_c,_c=B)):(fG=_c,_c=B)}_b!==B?(_c=fG,fL++,_d=iC(),_d==B&&(_d=iD()),fL--,_d!==B?(fG=_c,_c=void 0):(_c=B),_c!==B?(fH=C,_b=dY(_b),C=_b):(fG=C,C=B)):(fG=C,C=B);fL--;C==B&&(_b=B,!fL&&fW(dX));return C}function hR(){var C,_b,_c;C=fG;_b=hU();_b==B&&(_b=null);_b!==B?(_c=hS(),_c!==B?(fH=C,_b=dZ(),C=_b):(fG=C,C=B)):(fG=C,C=B);return C}function hS(){var C,_b,_c,_d,E;C=fG;_b=hT();_b!==B?(_c=fG,A.charCodeAt(fG)==46?(_d=eA,fG++):(_d=B,!fL&&fW(eB)),_d!==B?(E=hT(),E!==B?(_d=[_d,E],_c=_d):(fG=_c,_c=B)):(fG=_c,_c=B),_c==B&&(_c=null),_c!==B?(_b=[_b,_c],C=_b):(fG=C,C=B)):(fG=C,C=B);return C}function hT(){var C,_b;C=[];eC.test(A.charAt(fG))?(_b=A.charAt(fG),fG++):(_b=B,!fL&&fW(eD));if(_b!==B)while (_b!==B) {C.push(_b);eC.test(A.charAt(fG))?(_b=A.charAt(fG),fG++):(_b=B,!fL&&fW(eD))}else C=B;return C}function hU(){var C;eE.test(A.charAt(fG))?(C=A.charAt(fG),fG++):(C=B,!fL&&fW(eF));return C}function hV(){var C,_b,_c,_d,E;C=fG;A.substr(fG,4)==eG?(_b=eG,fG+=4):(_b=B,!fL&&fW(eH));_b!==B?(_c=hW(),_c!==B?(_d=hO(),_d!==B?(E=hW(),E!==B?(fH=C,_b=eI(_d),C=_b):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B)):(fG=C,C=B);return C}function hW(){var C,_b,_c,_d,E;fL++;C=[];_b=iB();_b==B&&(_b=fG,_c=iC(),_c!==B?(_d=fG,fL++,E=hD(),fL--,E==B?_d=void 0:fG=_d,_d!==B?(_c=[_c,_d],_b=_c):(fG=_b,_b=B)):(fG=_b,_b=B));while (_b!==B) {C.push(_b);_b=iB();_b==B&&(_b=fG,_c=iC(),_c!==B?(_d=fG,fL++,E=hD(),fL--,E==B?_d=void 0:fG=_d,_d!==B?(_c=[_c,_d],_b=_c):(fG=_b,_b=B)):(fG=_b,_b=B))}fL--;C==B&&(_b=B,!fL&&fW(eJ));return C}function hX(){var C,_b;fL++;C=[];_b=iA();_b==B&&(_b=iC(),_b==B&&(_b=iB()));while (_b!==B) {C.push(_b);_b=iA();_b==B&&(_b=iC(),_b==B&&(_b=iB()))}fL--;C==B&&(_b=B,!fL&&fW(eK));return C}function hY(){var C,_b,_c,_d;C=fG;_b=fG;fL++;_c=[];A.charCodeAt(fG)==32?(_d=eL,fG++):(_d=B,!fL&&fW(eM));while (_d!==B) {_c.push(_d);A.charCodeAt(fG)==32?(_d=eL,fG++):(_d=B,!fL&&fW(eM))}fL--;_c!==B?(fG=_b,_b=void 0):(_b=B);_b!==B&&(fH=C,_b=eN());C=_b;return C}function hZ(){var C,_b,_c,_d;fL++;C=fG;A.substr(fG,2)==eP?(_b=eP,fG+=2):(_b=B,!fL&&fW(eQ));if(_b!==B){_c=[];eR.test(A.charAt(fG))?(_d=A.charAt(fG),fG++):(_d=B,!fL&&fW(eS));while (_d!==B) {_c.push(_d);eR.test(A.charAt(fG))?(_d=A.charAt(fG),fG++):(_d=B,!fL&&fW(eS))}_c!==B?(fH=C,_b=eT(_c),C=_b):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(eO));return C}function iA(){var C,_b,_c,_d;fL++;C=fG;A.substr(fG,2)==eP?(_b=eP,fG+=2):(_b=B,!fL&&fW(eQ));if(_b!==B){_c=[];eR.test(A.charAt(fG))?(_d=A.charAt(fG),fG++):(_d=B,!fL&&fW(eS));while (_d!==B) {_c.push(_d);eR.test(A.charAt(fG))?(_d=A.charAt(fG),fG++):(_d=B,!fL&&fW(eS))}_c!==B?(fH=C,_b=eU(_c),C=_b):(fG=C,C=B)}else{fG=C;C=B}fL--;C==B&&(_b=B,!fL&&fW(eO));return C}function iB(){var C;fL++;A.charCodeAt(fG)==32?(C=eL,fG++):(C=B,!fL&&fW(eM));C==B&&A.charCodeAt(fG)==9?(C=eW,fG++):(C=B,!fL&&fW(eX));fL--;C==B&&!fL&&fW(eV);return C}function iC(){var C;fL++;A.substr(fG,2)==eZ?(C=eZ,fG+=2):(C=B,!fL&&fW(fA));C==B&&(A.charCodeAt(fG)==10?(C=fB,fG++):(C=B,!fL&&fW(fC)),C==B&&A.charCodeAt(fG)==13?(C=fD,fG++):(C=B,!fL&&fW(fE)));fL--;C==B&&!fL&&fW(eY);return C}function iD(){var C,_b,_c;C=fG;_b=fG;fL++;A.length>fG?(_c=A.charAt(fG),fG++):(_c=B,!fL&&fW(bD));fL--;_c==B?_b=void 0:fG=_b;_b!==B&&(fH=C,_b=fF());C=_b;return C}var iE=null,iF=null,iG="moodle",iH=iG,iI={"\\\\":"&&092;","\\:":"&&058;","\\#":"&&035;","\\=":"&&061;","\\{":"&&123;","\\}":"&&125;","\\~":"&&126;","\\n":"&&010"};function iJ(C){return C.replaceAll('&&092;','\\').replaceAll('&&058;',':').replaceAll('&&035;','#').replaceAll('&&061;','=').replaceAll('&&123;','{').replaceAll('&&125;','}').replaceAll('&&126;','~').replaceAll('&&010','\n')}function iK(C,_b){C.globalFeedback=_b.globalFeedback;switch(C.type) {case "TF":C.isTrue=_b.isTrue;C.trueFeedback=_b.feedback[0];C.falseFeedback=_b.feedback[1];break;case "MC":case "Numerical":case "Short":C.choices=_b.choices;break;case "Matching":C.matchPairs=_b.matchPairs;break}C.type=="MC"&&iL(C.choices)&&(C.type="Short");C.id=iE;C.tags=iF;return C}function iL(C){var _b=!0;for(var i=0;i<C.length;i++)_b&=C[i].isCorrect;return _b}function iM(C){C=C.replace(/[\n\r]/g,' ');return C.replace(/\s\s+/g,' ')}function iN(C){iH=C}function iO(){return iH}function iP(){iH=iG}function iQ(C,_b){let _c=(C!==null?C:iO());let _d=_b.join('').replace(/\r\n/g,'\n').trim();return{format:(_c),text:(((_c=="html")||(_c=="markdown"))?iJ(_d):iJ(iM(_d)))}}fM=fY();if(fM!==B&&fG==A.length)return fM;fM!==B&&fG<A.length&&fW(fS());throw fX(fK,fJ<A.length?A.charAt(fJ):null,fJ<A.length?fV(fJ,fJ+1):fV(fJ,fJ))}module.exports={SyntaxError:c,parse:d};
